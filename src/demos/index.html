<!DOCTYPE html>
<html>
<head>
<title>Element.animate() polyfill demo</title>
<style>
.left, .right {
  width:50%;
  position:absolute;
  top:40px;
  bottom:0;
}
.left {
  left:0;
  border-right:5px solid black;
}
.right {
  right:0;
  border-left:5px solid black;
}
#animate {
  height: 150px;
  width: 150px;
  background-color: red;
}
nav {
  position:fixed;
  top:0;
  left:0;
  right:0;
  padding:5px;
  background:rgba(0,0,0,0.5);
  z-index:1000;
}

.cont {
  height: 40px;
}
</style>
</head>
<body>

<nav>
  <button id="animateplay">Reset and Play</button>
  <button id="play">Play</button>
  <button id="pause">Pause</button>
  <button id="cancel">Cancel</button>
  <button id="finish">Finish</button>
  <input id="currentTimeInput" type="number" placeholder="Enter currentTime" value="4000">
  <button id="currentTime">Set currentTime</button>
</nav>

<div class="left">
  <span>Native</span>
  <div id="animate1"></div>
</div>
<div class="right">
  <span>Polyfill</span>
  <div id="animate2"></div>
</div>


<script type="text/javascript" src="../element-animate-polyfill.js"></script>
<script>
var animate = document.getElementById('animateplay');
var play = document.getElementById('play');
var pause = document.getElementById('pause');
var cancel = document.getElementById('cancel');
var finish = document.getElementById('finish');
var currentTime = document.getElementById('currentTime');

var currentTimeInput = document.getElementById('currentTimeInput')

var el1 = document.getElementById('animate1');
var el2 = document.getElementById('animate2');

var pNative;
var pPoly;

animate.addEventListener('click', function() {
  var animation = [
    {height: "150px", transform: 'rotate(0deg)', background:'hsla(120,100%,50%,0.5)'},
    {height: "400px", transform: 'rotate(360deg)', background:'rgba(255,100,0,0.2)'}
  ];
  var options = {
    duration: 5000,
    fill: 'forwards',
    easing: 'cubic-bezier(0,-0.85,0,.69)'
  };

  pNative = el1.animate(animation, options);
  pPoly = window['$$elementAnimateFn'](el2, animation, options);

  pNative.oncancel = addCallback('native', pNative, 'oncancel');
  pNative.onfinish = addCallback('native', pNative, 'onfinish');

  pPoly.oncancel = addCallback('poly', pPoly, 'oncancel');
  pPoly.onfinish = addCallback('poly', pPoly, 'onfinish');

});

play.addEventListener('click', function() {

  if (pNative) {
    pNative.play();
    console.log('native', 's', pNative.startTime, 'c', pNative.currentTime);
  }

  if (pPoly) {
    pPoly.play();
    console.log('poly', 's', pNative.startTime, 'c', pNative.currentTime);
  }


});

pause.addEventListener('click', function() {
  console.log('pause');
  console.log('native', pNative.playState);
  console.log('poly', pPoly.playState);
  pNative.pause();
  pPoly.pause();
  console.log('native', pNative.playState);
  console.log('poly', pPoly.playState);
  setTimeout(() => {
    console.log('after timeout');
    console.log('native', pNative.playState, 's', pNative.startTime, 'c', pNative.currentTime);
    console.log('poly', pPoly.playState, 's', pPoly.startTime, 'c', pPoly.currentTime);
  });
});

cancel.addEventListener('click', function() {
  console.log('cancel');
  console.log('native', pNative.playState);
  console.log('poly', pPoly.playState);
  pNative.cancel();
  pPoly.cancel();
  console.log('native', pNative.playState);
  console.log('poly', pPoly.playState);
});

finish.addEventListener('click', function() {
  pNative.finish();
  pPoly.finish();
});

currentTime.addEventListener('click', function() {
  var newTime = parseInt(currentTimeInput.value);
  pNative.currentTime = newTime;
  pPoly.currentTime = newTime;
  setTimeout(function() {
    console.log('playState after setCurrenTime:', 'pNative', pNative.playState, 'pPoly', pPoly.playState)
  });
});

function addCallback(type, player, event) {
  return function(e) {
    console.log(type, player, 'currentTime', player.currentTime, 'playstate', player.playState);
  };
}

</script>
<script>
  document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
  ':35729/livereload.js?snipver=1"></' + 'script>')
</script>
</body>
</html>
